<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Planner de Estudos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">
  <h1 class="text-2xl font-bold mb-4">📅 Planner de Estudos</h1>

  <!-- Área de login -->
  <div id="loginArea">
    <button id="loginBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
      Entrar com Google
    </button>
  </div>

  <!-- Área do planner -->
  <div id="plannerArea" class="hidden w-full max-w-4xl">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold">Suas Semanas</h2>
      <button id="logoutBtn" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded">
        Sair
      </button>
    </div>

    <!-- Lista de semanas -->
    <div id="weeksContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
  </div>

  <script>
    // CONFIG FIREBASE (substituir pelos seus dados)
   const firebaseConfig = {
  apiKey: "AIzaSyDtkw14S6v60cbjPKuqtzzQoCJRlzlR6w4",
  authDomain: "planner-de-estudos-ec7c4.firebaseapp.com",
  projectId: "planner-de-estudos-ec7c4",
  storageBucket: "planner-de-estudos-ec7c4.firebasestorage.app",
  messagingSenderId: "809041087779",
  appId: "1:809041087779:web:66819ca4f44a90f26a5096"
};

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginArea = document.getElementById("loginArea");
    const loginBtn = document.getElementById("loginBtn");
    const plannerArea = document.getElementById("plannerArea");
    const logoutBtn = document.getElementById("logoutBtn");
    const weeksContainer = document.getElementById("weeksContainer");

    let plannerRef = null;
    let unsubscribe = null;

    // LOGIN
    loginBtn.addEventListener("click", () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).catch(err => {
        alert("Erro no login: " + err.message);
        console.error(err);
      });
    });

    // LOGOUT
    logoutBtn.addEventListener("click", () => {
      if (unsubscribe) unsubscribe();
      auth.signOut();
    });

    // MONITOR DE LOGIN
    auth.onAuthStateChanged(user => {
      if (user) {
        loginArea.classList.add("hidden");
        plannerArea.classList.remove("hidden");
        startPlanner(user.uid);
      } else {
        plannerArea.classList.add("hidden");
        loginArea.classList.remove("hidden");
      }
    });

    // CRIA ESTRUTURA INICIAL DE 52 SEMANAS
    function createInitialPlanner() {
      const weeks = [];
      for (let i = 1; i <= 52; i++) {
        weeks.push({
          week: i,
          tasks: []
        });
      }
      return { weeks };
    }

    // INICIA PLANNER DO USUÁRIO
    function startPlanner(uid) {
      plannerRef = db.collection("planners").doc(uid);

      unsubscribe = plannerRef.onSnapshot(async (doc) => {
        if (doc.exists) {
          renderWeeks(doc.data().weeks || []);
        } else {
          try {
            await plannerRef.set(createInitialPlanner());
            console.log("Planner inicial criado.");
          } catch (err) {
            alert("Erro\nNão foi possível inicializar os dados. Veja o console do browser para mais detalhes.");
            console.error(err);
          }
        }
      });
    }

    // RENDERIZA TODAS AS SEMANAS
    function renderWeeks(weeks) {
      weeksContainer.innerHTML = "";
      weeks.forEach(weekObj => {
        const card = document.createElement("div");
        card.className = "bg-white shadow rounded p-3";

        const title = document.createElement("h3");
        title.className = "font-bold mb-2";
        title.textContent = "Semana " + weekObj.week;
        card.appendChild(title);

        // Lista de tarefas
        const ul = document.createElement("ul");
        (weekObj.tasks || []).forEach((t, i) => {
          const li = document.createElement("li");
          li.className = "flex justify-between items-center mb-1";

          const span = document.createElement("span");
          span.textContent = t.text;
          if (t.done) span.classList.add("line-through", "text-gray-500");

          const btns = document.createElement("div");

          const doneBtn = document.createElement("button");
          doneBtn.textContent = t.done ? "↩️" : "✅";
          doneBtn.className = "mr-2";
          doneBtn.onclick = () => toggleTask(weekObj.week, i, !t.done);

          const delBtn = document.createElement("button");
          delBtn.textContent = "🗑️";
          delBtn.onclick = () => deleteTask(weekObj.week, i);

          btns.appendChild(doneBtn);
          btns.appendChild(delBtn);

          li.appendChild(span);
          li.appendChild(btns);
          ul.appendChild(li);
        });
        card.appendChild(ul);

        // Campo para adicionar
        const divAdd = document.createElement("div");
        divAdd.className = "flex mt-2";
        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = "Nova tarefa...";
        input.className = "flex-grow border rounded px-2 py-1";
        const btn = document.createElement("button");
        btn.textContent = "+";
        btn.className = "ml-2 bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded";
        btn.onclick = () => {
          const text = input.value.trim();
          if (!text) return;
          addTask(weekObj.week, text);
          input.value = "";
        };
        divAdd.appendChild(input);
        divAdd.appendChild(btn);
        card.appendChild(divAdd);

        weeksContainer.appendChild(card);
      });
    }

    // ADICIONA TAREFA
    function addTask(weekNumber, text) {
      plannerRef.get().then(doc => {
        if (doc.exists) {
          const data = doc.data();
          const weeks = data.weeks;
          const idx = weeks.findIndex(w => w.week === weekNumber);
          weeks[idx].tasks.push({ text, done: false });
          plannerRef.set({ weeks });
        }
      });
    }

    // TOGGLE TAREFA
    function toggleTask(weekNumber, taskIndex, done) {
      plannerRef.get().then(doc => {
        if (doc.exists) {
          const data = doc.data();
          const weeks = data.weeks;
          const idx = weeks.findIndex(w => w.week === weekNumber);
          weeks[idx].tasks[taskIndex].done = done;
          plannerRef.set({ weeks });
        }
      });
    }

    // DELETAR TAREFA
    function deleteTask(weekNumber, taskIndex) {
      plannerRef.get().then(doc => {
        if (doc.exists) {
          const data = doc.data();
          const weeks = data.weeks;
          const idx = weeks.findIndex(w => w.week === weekNumber);
          weeks[idx].tasks.splice(taskIndex, 1);
          plannerRef.set({ weeks });
        }
      });
    }
  </script>
</body>
</html>

