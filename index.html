<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Meu Planner Semanal</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 2rem;
      background: #f2f2f2;
    }
    h1 {
      text-align: center;
    }
    .day {
      background: #fff;
      margin-bottom: 1rem;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .day h2 {
      margin: 0;
    }
    textarea {
      width: 100%;
      height: 80px;
      margin-top: 0.5rem;
      resize: vertical;
    }
    #status {
      position: fixed;
      top: 10px;
      right: 10px;
      background: #fffae6;
      padding: 0.5rem 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h1>Planner Semanal</h1>
  <div id="status">Conectando...</div>
  <div id="planner"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

  <script>
    // üîß Substitua com sua configura√ß√£o do Firebase:
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_DOMINIO.firebaseapp.com",
      projectId: "SEU_PROJECT_ID",
      storageBucket: "SEU_BUCKET.appspot.com",
      messagingSenderId: "SEU_SENDER_ID",
      appId: "SUA_APP_ID"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const days = ["Segunda", "Ter√ßa", "Quarta", "Quinta", "Sexta", "S√°bado", "Domingo"];
    const plannerEl = document.getElementById('planner');
    const statusEl = document.getElementById('status');

    let userId = null;

    // Cria UI
    function createUI(data = {}) {
      plannerEl.innerHTML = "";
      days.forEach((day, index) => {
        const content = data[day] || "";
        const div = document.createElement('div');
        div.className = 'day';

        const h2 = document.createElement('h2');
        h2.textContent = day;

        const textarea = document.createElement('textarea');
        textarea.value = content;
        textarea.addEventListener('input', () => {
          saveDayData(day, textarea.value);
        });

        div.appendChild(h2);
        div.appendChild(textarea);
        plannerEl.appendChild(div);
      });
    }

    // Salva no Firestore
    function saveDayData(day, value) {
      if (!userId) return;
      const docRef = db.collection("planners").doc(userId);
      docRef.set({ [day]: value }, { merge: true })
        .then(() => {
          statusEl.textContent = `Salvo: ${day}`;
        })
        .catch(err => {
          console.error("Erro ao salvar:", err);
          statusEl.textContent = "Erro ao salvar (permiss√£o?)";
        });
    }

    // Observa altera√ß√µes em tempo real
    function setupRealtimeListener() {
      const docRef = db.collection("planners").doc(userId);
      docRef.onSnapshot(doc => {
        if (doc.exists) {
          createUI(doc.data());
          statusEl.textContent = "Planner carregado.";
        } else {
          createUI();
          statusEl.textContent = "Novo planner criado.";
        }
      }, err => {
        console.error("Erro ao escutar:", err);
        statusEl.textContent = "Erro de permiss√£o ao carregar planner.";
      });
    }

    // Autentica√ß√£o an√¥nima
    auth.onAuthStateChanged(user => {
      if (user) {
        userId = user.uid;
        statusEl.textContent = "Usu√°rio autenticado.";
        setupRealtimeListener();
      } else {
        auth.signInAnonymously()
          .catch(err => {
            console.error("Erro ao autenticar:", err);
            statusEl.textContent = "Erro na autentica√ß√£o.";
          });
      }
    });
  </script>
</body>
</html>
